# 前端设计文档

## 1. 整体架构

本项目使用 Next.js 13+ 框架开发，采用 App Router 架构，集成了 shadcn/ui 组件库，使用 Tailwind CSS 进行样式管理。

### 技术栈
- Next.js 13+
- React 18+
- TypeScript
- Tailwind CSS
- shadcn/ui 组件库

## 2. 页面结构

### 2.1 登录界面 (`components/login-page.tsx`)
#### Web3 钱包登录流程
1. 用户点击"连接钱包"按钮
2. 调用 Web3.js 连接钱包
   - 检查是否安装 MetaMask
   - 请求用户授权连接
3. 获取钱包地址并签名
   - 生成签名消息（包含时间戳和应用标识）
   - 请求用户签名
4. 调用后端登录接口
   - 发送钱包地址和签名到 `/api/v1/auth/login`
   - 获取访问令牌和过期时间
5. 保存登录状态
   - 本地存储访问令牌（access_token）
   - 本地存储钱包地址（wallet_address）
   - 本地存储过期时间（token_expires_at）
6. 跳转到主页

#### 认证工具函数 (`utils/auth.ts`)
1. 登录状态管理：
   - `isLoggedIn()`: 检查用户是否已登录
   - `getAccessToken()`: 获取访问令牌
   - `getWalletAddress()`: 获取钱包地址
2. 令牌管理：
   - `clearAuthData()`: 清除认证数据
   - `logout()`: 退出登录并清除数据

#### 错误处理
- 未安装钱包：提示用户安装 MetaMask
- 用户拒绝连接：显示"用户取消连接"提示
- 用户拒绝签名：显示"需要签名以继续"提示
- 登录失败：显示具体错误信息
- 令牌过期：自动清除认证数据并跳转登录页

#### 令牌管理机制
1. 令牌存储
   - 访问令牌（`access_token`）存储在 localStorage
   - 过期时间（`token_expires_at`）存储在 localStorage

2. 令牌处理流程
   - 登录时获取新令牌和过期时间
   - 每次 API 请求检查令牌是否过期
   - 令牌过期自动跳转登录页面
   - 退出时清除本地令牌存储

3. 接口调用
```typescript
// 登录接口
POST /api/v1/auth/login
Content-Type: application/json

Request:
{
    "wallet_address": string,  // 钱包地址
    "signature": string        // 签名结果
}

Response:
{
    "access_token": string,    // PAW 访问令牌
    "wallet_address": string,  // 钱包地址
    "expires_at": string       // 令牌过期时间
}

// 退出接口
POST /api/v1/auth/logout
Authorization: Bearer {access_token}
```

4. 错误处理
   - 令牌过期：跳转到登录页面
   - 网络错误：显示错误提示
   - 登录失败：显示具体错误信息

#### 接口调用
```typescript
// 登录接口
POST /api/v1/auth/login
Content-Type: application/json

Request:
{
    "wallet_address": string,  // 钱包地址
    "signature": string        // 签名结果
}

Response:
{
    "access_token": string,    // PAW 访问令牌
    "wallet_address": string   // 钱包地址
}
```

#### 错误处理
- 未安装钱包：提示用户安装 MetaMask
- 用户拒绝连接：显示"用户取消连接"提示
- 用户拒绝签名：显示"需要签名以继续"提示
- 登录失败：显示具体错误信息

- 钱包连接按钮
- 支持多种钱包授权登录
- 登录状态管理

### 2.2 主界面布局
- 底部导航栏，包含三个主要功能入口：
  - 浏览 Agent 故事（默认页面）
  - 创造 Agent 故事
  - 个人中心

### 2.3 浏览 Agent 故事界面
#### 界面元素
- 左上角：任务按钮（有新任务时会抖动提示）
- 右上角：对话历史按钮
- 中央区域：Agent 信息展示
  - Agent 标题
  - NFT 标志（如适用）
  - Agent 角色列表（最多显示5个）
  - 故事简介（支持滚动）
  - 背景图
- 底部区域：
  - 开场白
  - 作者信息（头像、昵称、钱包地址）
  - 互动按钮（点赞、评论、分享）
  - 输入区域（语音/文字切换）

#### 交互功能
- 支持上下滑动切换不同 Agent
- 双击界面任意位置点赞
- 语音输入手势控制
  - 按住说话
  - 上滑取消
  - 左右滑切换场景/动作输入模式

### 2.4 创造 Agent 故事界面
#### 模板选择
- 模板展示区（6个位置，当前支持3个）
- 每日创建限额显示
- 模板详情展示：
  - 背景图
  - 主题
  - 图标
  - 简介
  - 使用人数

#### 模板类型
1. 自由剧情模板
2. 海龟汤模板
3. 创造系统模板

### 2.5 个人中心界面
#### 用户信息区
- 头像
- 昵称
- 钱包地址
- 积分
- 获赞数量
- 设置按钮

#### 作品展示区
- 分类标签：All/Normal/Premium
- 网格式展示（每行2个）
- NFT 铸造功能
- 作品详情展示

## 3. 功能模块

### 3.1 对话系统
- 输入方式切换：
  - 语音输入（默认）：
    - 按住说话：按钮变黑色
    - 上滑取消：按钮变红色
    - 左右滑动：按钮变白色，切换场景/动作输入模式
    - 回划：返回对话输入模式
  - 文字输入：点击切换按钮展开输入框
- 对话显示：
  - Agent对话框：
    - 位置：左侧
    - 背景：半透明灰色（opacity: 0.8）
    - 场景/动作：深灰色，括号包裹
    - 对话文字：黑色
  - 用户对话框：
    - 位置：右侧
    - 背景：半透明黑色（opacity: 0.8）
    - 场景/动作：浅灰色，括号包裹
    - 对话文字：白色
- 历史记录界面：
  - 全屏覆盖显示
  - 支持上下滑动查看
  - 按时间倒序排列
  - 显示完整对话上下文

### 3.2 任务系统
#### 日常任务
- 任务类型：
  - 点赞任务：点赞5个Story or Character（5积分）
  - 分享任务：分享1个Story or Character（5积分）
  - 创建任务：创建1个Story or Character（5积分）
- 任务UI：
  - 进度条显示当前完成情况
  - 任务状态图标：
    - 未完成：灰色圆圈
    - 已完成：绿色对勾
  - 奖励领取：
    - 未完成：灰色不可点击按钮
    - 可领取：蓝色可点击按钮
    - 已领取：灰色已领取文字

#### 成长任务
- 任务进度：
  - 点赞智能体：5/10/50/100阶段性目标
  - 创造智能体：递增目标
  - 铸造NFT：递增目标
- 显示规则：
  - 只显示当前阶段目标
  - 完成后自动解锁下一阶段
  - 显示累计完成数量

### 3.3 NFT 系统
- 点赞数量达标后可铸造
- 铸造状态显示
- Premium 标识展示

## 4. 样式规范

### 4.1 配色方案
- Agent 对话框：半透明灰色
- 用户对话框：半透明黑色
- 场景/动作文字：深灰色（Agent）/浅灰色（用户）
- 对话文字：黑色（Agent）/白色（用户）

### 4.2 交互规范
- 按钮状态：
  - 默认状态
  - 禁用状态（灰色）
  - 激活状态（黄褐色）
- 动画效果：
  - 任务提醒抖动
  - 页面切换过渡
  - 模态框弹出/收起

## 5. 性能优化
- 图片懒加载
- 组件按需加载
- 路由预加载
- 状态管理优化 